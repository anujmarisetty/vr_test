<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>Display VR Device Type</title>
    <script src='./x3dom-full.js'></script>
    <link rel='stylesheet' type='text/css' href='https://www.x3dom.org/download/x3dom.css'/>
</head>
<body>
    <h1>VR Device Type Detection</h1>
    <div id="deviceInfo" style="font-size: 18px; color: black; padding: 10px;">Device Type: Detecting...</div>
    <x3d width='800px' height='600px'>
        <scene>
            <shape>
                <appearance>
                    <material diffuseColor="0 1 0"></material>
                </appearance>
                <box></box>
            </shape>
        </scene>
    </x3d>
    <button id="enterVR" style="position: fixed; bottom: 10px; right: 10px;">Enter VR</button>
    <script>
        let vrSession = null;
        const deviceInfo = document.getElementById('deviceInfo');

        document.getElementById('enterVR').addEventListener('click', () => {
            if (navigator.xr) {
                navigator.xr.requestSession("immersive-vr", { requiredFeatures: ["local-floor"] })
                    .then((session) => {
                        vrSession = session;
                        vrSession.addEventListener("end", onSessionEnded);
                        onSessionStarted(vrSession);
                    });
            } else {
                console.warn("WebXR not supported on this browser.");
                deviceInfo.textContent = "Device Type: WebXR not supported on this browser";
            }
        });

        function onSessionStarted(session) {
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.xr.enabled = true;
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            renderer.xr.setSession(session);

            renderer.domElement.requestFullscreen().catch((err) => {
                console.warn("Unable to enter fullscreen mode:", err);
            });

            session.requestAnimationFrame(onXRFrame);
        }

        function onSessionEnded() {
            vrSession = null;
            document.querySelector("canvas").remove();
            deviceInfo.textContent = "Device Type: VR session ended";  
        }

        function onXRFrame(time, frame) {
            const session = frame.session;
            const referenceSpace = session.requestReferenceSpace("local").then((refSpace) => {
                const inputSources = session.inputSources;
                let deviceType = "Unknown";

                inputSources.forEach((inputSource) => {
                    if (inputSource.hand) return; 

                    if (inputSource.profiles.length > 0) {
                        deviceType = inputSource.profiles[0];
                    }
                });
                deviceInfo.textContent = `Device Type: ${deviceType}`;

                session.requestAnimationFrame(onXRFrame);
            });
        }
    </script>
</body>
</html>
